# UserDefinedPhraser
> Doc Version: 1.1.1-20200531

[ğŸ‡ºğŸ‡¸ English](README.md) | ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡

* å°†é¢„å®šä¹‰çš„ç”¨æˆ·è‡ªå®šä¹‰çŸ­è¯­ï¼ˆUDPï¼‰è½¬åŒ–ä¸ºå¯è¢« Win10 å¾®è½¯æ‹¼éŸ³ã€macOS æ‹¼éŸ³è¾“å…¥æ³•ï¼ˆ+iOS/iPadOSï¼‰ã€QQ æ‹¼éŸ³ç­‰è¾“å…¥æ³•ä½¿ç”¨çš„å¯¼å…¥æ–‡ä»¶ã€‚è¿˜å¯ä»¥ç”Ÿæˆ HTML ç”¨äºæŸ¥çœ‹å’Œ JSON æ–‡ä»¶ç”¨äºè¿›ä¸€æ­¥å¤„ç†ã€‚

## åŸºç¡€
* ç¨‹åºä»¥ `.json` æ–‡ä»¶ä¸ºåŸºå‡†ï¼Œè½¬åŒ–ä¸ºå…¶ä»–æ ¼å¼ã€‚

## ä½¿ç”¨æ–¹æ³•

```py
# å¿«é€Ÿå¼€å§‹
python3 run_parser.py
```

```sh
|-- Phrasers/  # å°†ç›®æ ‡æ ¼å¼è§£æä¸º python å­—å…¸ï¼Œå¹¶å°† python å­—å…¸è½¬ä¸ºç›®æ ‡æ ¼å¼ã€‚
    |-- phraser.py  # æ‰€æœ‰ Phraser ç±»çš„åŸºç±»
    |-- jsonphraser.py  # è´Ÿè´£ json æ ¼å¼æ–‡ä»¶çš„è§£æã€‚
    |-- tomlphraser.py  # è´Ÿè´£ toml æ ¼å¼æ–‡ä»¶çš„è§£æã€‚
    |-- macphraser.py  # è´Ÿè´£ macOS `.plist` æ–‡ä»¶çš„è§£æã€‚
    |-- msphraser.py  # è´Ÿè´£ Win10 æ‹¼éŸ³è¾“å…¥æ³• `.dat` æ–‡ä»¶çš„è§£æã€‚
    |-- txtphraser.py  # è´Ÿè´£ QQ æ‹¼éŸ³ `.ini` æ–‡ä»¶çš„è§£æã€‚
    |-- htmlphraser.py  # è´Ÿè´£ç”Ÿæˆ `.html` æ–‡ä»¶ã€‚
    |-- htmlphraser_tpl.py  # è´Ÿè´£ä¸ºç”Ÿæˆçš„ `.html` æ–‡ä»¶æä¾›æ¨¡æ¿
|-- Phrases/  # ç”¨æˆ·å®šä¹‰çš„çŸ­è¯­ï¼Œè¿™äº›æ–‡ä»¶æ˜¯æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶çš„æ ¹æœ¬ã€‚
    |-- UDP-*.json  # ä»…å½“ä½¿ç”¨ .json å­˜å‚¨çš„ UDP æ–‡ä»¶ã€‚
    |-- UDP-*.toml  # ä»…å½“ä½¿ç”¨ .toml å­˜å‚¨çš„ UDP æ–‡ä»¶ã€‚
|-- GeneratedUDP/  # æ­¤ç›®å½•å­˜æ”¾ç”Ÿæˆçš„æ–‡ä»¶ï¼Œé‡Œé¢çš„æ–‡ä»¶å¯ä»¥éšæ—¶åˆ é™¤ã€‚
|-- user_defined_phraser.py  # ç¨‹åºæ€»å…¥å£ï¼Œè´Ÿè´£å°† `.json` æˆ– `.toml` çš„æ ¼å¼è½¬ä¸ºå…¶ä»–æ ¼å¼ã€‚
```

* æ‰€æœ‰ Python Dict å’Œ JSON çš„æ ¼å¼å‡ä¸ºï¼š`{ 'phrase': "<PHRASE>", 'shortcut': "<SHORTCUT>" }`
* `*Phraser` ç±»éƒ½åŒ…å«äº† `to_file()`ï¼Œ`from_file()`ï¼Œ`to_format*()`ï¼Œ`from_format*()` å‡ ç§å‡½æ•°ã€‚åˆ†åˆ«ç”¨äºç”Ÿæˆã€è¯»å–æ–‡ä»¶ï¼Œä»¥åŠç”Ÿæˆã€è¯»å–å¯¹åº”æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚

************

# å¾®è½¯æ‹¼éŸ³è¾“å…¥æ³•
## æ‰‹åŠ¨æ“ä½œ
### åˆ é™¤
1. ç³»ç»Ÿè®¾ç½® â†’ æ—¶é—´å’Œè¯­è¨€ â†’ åŒºåŸŸå’Œè¯­è¨€ â†’ ä¸­æ–‡ï¼ˆä¸­åäººæ°‘å…±å’Œå›½ï¼‰ â†’ é€‰é¡¹ â†’ å¾®è½¯æ‹¼éŸ³ â†’ é€‰é¡¹
2. è¯åº“å’Œè‡ªå­¦ä¹  â†’ æ·»åŠ æˆ–ç¼–è¾‘è‡ªå®šä¹‰çŸ­è¯­ â†’ æ¸…é™¤

### æ·»åŠ 
1. ç³»ç»Ÿè®¾ç½® â†’ æ—¶é—´å’Œè¯­è¨€ â†’ åŒºåŸŸå’Œè¯­è¨€ â†’ ä¸­æ–‡ï¼ˆä¸­åäººæ°‘å…±å’Œå›½ï¼‰ â†’ é€‰é¡¹ â†’ å¾®è½¯æ‹¼éŸ³ â†’ é€‰é¡¹
2. è¯åº“å’Œè‡ªå­¦ä¹  â†’ æ·»åŠ æˆ–ç¼–è¾‘è‡ªå®šä¹‰çŸ­è¯­ â†’ å¯¼å…¥
3. `UserDefinedPhrase.dat`

### æ ¼å¼
* æ–‡ä»¶åç¼€ï¼š`.dat` æˆ– `.lex`ã€‚
* ä½¿ç”¨ `mschxudp` çš„è‡ªå®šä¹‰æ ¼å¼ï¼Œéšç€ç³»ç»Ÿç‰ˆæœ¬æ›´æ–°ä¹Ÿä¼šæ›´æ–°ã€‚

### å‚è€ƒå·¥å…·
* [imewlconverter Â· Github](https://github.com/studyzy/imewlconverter/tree/V2.3)
* [mschxudp Â· Github](https://github.com/hhggit/mschxudp)

## æ–‡ä»¶èŒƒä¾‹
```
# win10 1703
#           proto8                   unknown_X   version
# 00000000  6d 73 63 68 78 75 64 70  02 00 60 00 01 00 00 00  |mschxudp..`.....|
#           phrase_offset_start
#                       phrase_start phrase_end  phrase_count
# 00000010  40 00 00 00 48 00 00 00  98 00 00 00 02 00 00 00  |@...H...........|
#           timestamp
# 00000020  49 4e 06 59 00 00 00 00  00 00 00 00 00 00 00 00  |IN.Y............|
# 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
#                                                      candidate2
#           phrase_offsets[]         magic_X     phrase_offset2
# 00000040  00 00 00 00 24 00 00 00  10 00 10 00 18 00 06 06  |....$...........|
#           phrase_unknown8_X        pinyin
# 00000050  00 00 00 00 96 0a 99 20  61 00 61 00 61 00 00 00  |....... a.a.a...|
#           phrase                               magic_X
# 00000060  61 00 61 00 61 00 61 00  61 00 00 00 10 00 10 00  |a.a.a.a.a.......|
#                       phrase_unknown8_X
#                 candidate2
#           offset2                        pinyin
# 00000070  1a 00 07 06 00 00 00 00  a6 0a 99 20 62 00 62 00  |........... b.b.|
#                             phrase
# 00000080  62 00 62 00 00 00 62 00  62 00 62 00 62 00 62 00  |b.b...b.b.b.b.b.|
# 00000090  62 00 62 00 62 00 00 00                           |b.b.b...|
```

* `proto8`: `'mschxudp'`
* `phrase_offset_start + 4 * phrase_count == phrase_start`
* `phrase_start + phrase_offsets[N] == magic(0x00080008)`
* `pinyin&phrase`: utf16-le string
* `hanzi_offset = 8 + len(pinyin)`
* `phrase_offsets[N] + offset + len(phrase) == phrase_offsets[N+1]`
* `candidate2`: ç¬¬ä¸€ä¸ªå­—èŠ‚ä»£è¡¨çŸ­è¯­åœ¨å€™é€‰æ¡†ä½ç½®

************

# macOS è¾“å…¥æ³•
## æ‰‹åŠ¨æ“ä½œ
### æ¸…ç©º
1. ç³»ç»Ÿåå¥½è®¾ç½® â†’ é”®ç›˜ â†’ æ–‡æœ¬
2. ç‚¹ä¸­ä»»æ„é¡¹ï¼Œ<kbd>âŒ˜</kbd><kbd>A</kbd>ï¼Œç‚¹ <kbd>-</kbd> å·æˆ– <kbd>âŒ«</kbd>/<kbd>delete</kbd>

### æ·»åŠ 
1. ç³»ç»Ÿåå¥½è®¾ç½® â†’ é”®ç›˜ â†’ æ–‡æœ¬
2. æ‹–æ‹½ `*.plist` æ–‡ä»¶åˆ°â€œè¾“å…¥ç /çŸ­è¯­â€é‚£ä¸ªçª—å£å¤„ï¼ˆä¸€ä¸ªä¸ªçš„æ‹–ï¼‰ã€‚

* å·²å­˜åœ¨çš„é‡å¤é¡¹ä¸ä¼šé‡å¤æ·»åŠ ï¼Œä¼šæ™ºèƒ½æ·»åŠ ã€‚

### æ ¼å¼
* `.plist` æ–‡ä»¶ï¼Œ`xml` æ ¼å¼


## æ–‡ä»¶èŒƒä¾‹
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><?xml version="1.0" ?>
<plist version="1.0">
    <array>
        <dict>
            <key>phrase</key>
            <string>[æ–‡å­—]</string>
            <key>shortcut</key>
            <string>[æ‹¼å†™]</string>
        </dict>
        <dict>
            <key>phrase</key>
            <string>[æ–‡å­—]</string>
            <key>shortcut</key>
            <string>[æ‹¼å†™]</string>
        </dict>
    </array>
</plist>
```

************

# QQ æ‹¼éŸ³è¾“å…¥æ³•
## æ‰‹åŠ¨æ“ä½œ
### åˆ é™¤
1. QQè¾“å…¥æ³• â†’ å±æ€§è®¾ç½® â†’ è¯åº“ â†’ è‡ªå®šä¹‰çŸ­è¯­::è®¾ç½®
2. å¤šé€‰ï¼šæŒ‰ä½ <kbd>Ctrl</kbd> + <kbd>ç‚¹å‡»</kbd>ï¼Œä¸€ä¸ªä¸€ä¸ªç‚¹ã€‚
3. ç„¶åç‚¹åˆ é™¤ã€‚

### æ·»åŠ 
1. QQè¾“å…¥æ³• â†’ å±æ€§è®¾ç½® â†’ è¯åº“ â†’ è‡ªå®šä¹‰çŸ­è¯­::è®¾ç½®
2. ç‚¹ â€œå¯¼å…¥â€ï¼Œé€‰ä¸­æŸä¸ª `*.txt` æ–‡ä»¶ã€‚

### æ ¼å¼
* `.txt` æ–‡ä»¶

## æ–‡ä»¶èŒƒä¾‹
```ini
[æ‹¼å†™]=[ä½ç½®],[çŸ­è¯­]
[æ‹¼å†™]=[ä½ç½®],[çŸ­è¯­]
```
